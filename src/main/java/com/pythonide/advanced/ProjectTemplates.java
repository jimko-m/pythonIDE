package com.pythonide.advanced;

import java.io.*;
import java.util.*;
import java.util.zip.*;

/**
 * Project Templates Manager for Django, Flask, and Data Science projects
 * Provides pre-configured project structures and boilerplate code
 */
public class ProjectTemplates {
    private static final String TEMPLATES_PATH = "templates/";
    
    public enum TemplateType {
        DJANGO("Django Web Application"),
        FLASK("Flask Microframework"),
        DATA_SCIENCE("Data Science with Pandas"),
        FASTAPI("FastAPI REST API"),
        CONSOLE_APP("Console Application"),
        GUI_APP("GUI Application")
    }
    
    public static class ProjectTemplate {
        private String name;
        private TemplateType type;
        private String description;
        private Map<String, String> files;
        private List<String> dependencies;
        private String setupInstructions;
        
        public ProjectTemplate(String name, TemplateType type) {
            this.name = name;
            this.type = type;
            this.files = new HashMap<>();
            this.dependencies = new ArrayList<>();
            this.description = generateDescription(type);
            this.setupInstructions = generateInstructions(type);
            initializeTemplate();
        }
        
        private void initializeTemplate() {
            switch (type) {
                case DJANGO:
                    initializeDjangoTemplate();
                    break;
                case FLASK:
                    initializeFlaskTemplate();
                    break;
                case DATA_SCIENCE:
                    initializeDataScienceTemplate();
                    break;
                case FASTAPI:
                    initializeFastAPITemplate();
                    break;
                case CONSOLE_APP:
                    initializeConsoleTemplate();
                    break;
                case GUI_APP:
                    initializeGuitemplate();
                    break;
            }
        }
        
        private void initializeDjangoTemplate() {
            dependencies.add("Django>=3.2.0");
            dependencies.add("django-cors-headers>=3.10.0");
            
            files.put("manage.py", "#!/usr/bin/env python\nimport os\nimport sys\n\nif __name__ == '__main__':\n    os.environ.setdefault('DJANGO_SETTINGS_MODULE', '" + name.toLowerCase() + ".settings')\n    try:\n        from django.core.management import execute_from_command_line\n    except ImportError as exc:\n        raise ImportError(\n            \"Couldn't import Django. Are you sure it's installed?\"\n        ) from exc\n    execute_from_command_line(sys.argv)\n");
            
            files.put(name.toLowerCase() + "/__init__.py", "");
            files.put(name.toLowerCase() + "/settings.py", 
                "from pathlib import Path\nimport os\n\nDEBUG = True\n\nALLOWED_HOSTS = ['localhost', '127.0.0.1']\n\nINSTALLED_APPS = [\n    'django.contrib.admin',\n    'django.contrib.auth',\n    'django.contrib.contenttypes',\n    'django.contrib.sessions',\n    'django.contrib.messages',\n    'django.contrib.staticfiles',\n]\n\nMIDDLEWARE = [\n    'django.middleware.security.SecurityMiddleware',\n    'django.contrib.sessions.middleware.SessionMiddleware',\n    'django.middleware.common.CommonMiddleware',\n    'django.middleware.csrf.CsrfViewMiddleware',\n    'django.contrib.auth.middleware.AuthenticationMiddleware',\n    'django.contrib.messages.middleware.MessageMiddleware',\n]\n\nROOT_URLCONF = '" + name.toLowerCase() + ".urls'\n\nTEMPLATES = [\n    {\n        'BACKEND': 'django.template.backends.django.DjangoTemplates',\n        'DIRS': [os.path.join(BASE_DIR, 'templates')],\n        'APP_DIRS': True,\n    }\n]\n\nWSGI_APPLICATION = '" + name.toLowerCase() + ".wsgi.application'\n\nDATABASES = {\n    'default': {\n        'ENGINE': 'django.db.backends.sqlite3',\n        'NAME': os.path.join(BASE_DIR, 'db.sqlite3'),\n    }\n}\n\nSTATIC_URL = '/static/'\nSTATICFILES_DIRS = [os.path.join(BASE_DIR, 'static')]\n");
            
            files.put(name.toLowerCase() + "/urls.py", 
                "from django.contrib import admin\nfrom django.urls import path, include\n\nurlpatterns = [\n    path('admin/', admin.site.urls),\n]");
            
            files.put("apps/__init__.py", "");
            files.put("apps/models.py", 
                "from django.db import models\n\nclass BaseModel(models.Model):\n    created_at = models.DateTimeField(auto_now_add=True)\n    updated_at = models.DateTimeField(auto_now=True)\n    \n    class Meta:\n        abstract = True\n");
            
            files.put("templates/base.html", 
                "<!DOCTYPE html>\n<html lang=\"ar\" dir=\"rtl\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>{% block title %}تطبيق " + name + "{% endblock %}</title>\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css\" rel=\"stylesheet\">\n    {% block extra_css %}{% endblock %}\n</head>\n<body>\n    <nav class=\"navbar navbar-expand-lg navbar-dark bg-primary\">\n        <div class=\"container\">\n            <a class=\"navbar-brand\" href=\"#\">" + name + "</a>\n        </div>\n    </nav>\n    \n    <main class=\"container mt-4\">\n        {% block content %}{% endblock %}\n    </main>\n    \n    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js\"></script>\n    {% block extra_js %}{% endblock %}\n</body>\n</html>");
        }
        
        private void initializeFlaskTemplate() {
            dependencies.add("Flask>=2.0.0");
            dependencies.add("Flask-CORS>=3.0.0");
            dependencies.add("Flask-SQLAlchemy>=2.5.0");
            
            files.put("app.py", 
                "from flask import Flask, render_template, request, jsonify\nfrom flask_cors import CORS\nimport os\n\napp = Flask(__name__)\nCORS(app)\n\n@app.route('/')\ndef index():\n    return render_template('index.html')\n\n@app.route('/api/health')\ndef health_check():\n    return jsonify({'status': 'healthy', 'message': 'Flask app is running'})\n\n@app.route('/api/data/<int:id>', methods=['GET'])\ndef get_data(id):\n    return jsonify({'id': id, 'data': f'Sample data for ID {id}'})\n\nif __name__ == '__main__':\n    app.run(debug=True, host='0.0.0.0', port=5000)");
            
            files.put("templates/index.html",
                "<!DOCTYPE html>\n<html lang=\"ar\" dir=\"rtl\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>" + name + " - Flask Application</title>\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css\" rel=\"stylesheet\">\n</head>\n<body>\n    <div class=\"container mt-5\">\n        <div class=\"row justify-content-center\">\n            <div class=\"col-md-6\">\n                <h1 class=\"text-center mb-4\">مرحباً من " + name + "</h1>\n                <div class=\"card\">\n                    <div class=\"card-body\">\n                        <h5 class=\"card-title\">Flask Application</h5>\n                        <p class=\"card-text\">هذا تطبيق Flask مُعد مسبقاً مع جميع الإعدادات اللازمة</p>\n                        <button id=\"testBtn\" class=\"btn btn-primary\">اختبار API</button>\n                        <div id=\"result\" class=\"mt-3\"></div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n    \n    <script>\n        document.getElementById('testBtn').addEventListener('click', function() {\n            fetch('/api/health')\n                .then(response => response.json())\n                .then(data => {\n                    document.getElementById('result').innerHTML = \n                        '<div class=\"alert alert-success\">' + data.message + '</div>';\n                })\n                .catch(error => {\n                    document.getElementById('result').innerHTML = \n                        '<div class=\"alert alert-danger\">خطأ: ' + error + '</div>';\n                });\n        });\n    </script>\n</body>\n</html>");
            
            files.put("static/style.css",
                "/* Custom styles for Flask app */\nbody {\n    background-color: #f8f9fa;\n    font-family: 'Cairo', sans-serif;\n}\n\n.card {\n    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n}");
        }
        
        private void initializeDataScienceTemplate() {
            dependencies.add("pandas>=1.3.0");
            dependencies.add("numpy>=1.21.0");
            dependencies.add("matplotlib>=3.4.0");
            dependencies.add("seaborn>=0.11.0");
            dependencies.add("scikit-learn>=1.0.0");
            dependencies.add("jupyter>=1.0.0");
            
            files.put("main.py", 
                "import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.linear_model import LinearRegression\nfrom sklearn.metrics import mean_squared_error, r2_score\n\nclass DataScienceProject:\n    def __init__(self):\n        self.df = None\n        self.model = None\n        self.X_train = None\n        self.X_test = None\n        self.y_train = None\n        self.y_test = None\n    \n    def load_data(self, file_path):\n        \"\"\"Load data from CSV file\"\"\"\n        try:\n            self.df = pd.read_csv(file_path)\n            print(f\"Data loaded successfully. Shape: {self.df.shape}\")\n            return True\n        except Exception as e:\n            print(f\"Error loading data: {e}\")\n            return False\n    \n    def explore_data(self):\n        \"\"\"Explore and visualize data\"\"\"\n        if self.df is None:\n            print(\"No data loaded. Please load data first.\")\n            return\n        \n        print(\"Data Info:\")\n        print(self.df.info())\n        print(\"\\nDescriptive Statistics:\")\n        print(self.df.describe())\n        \n        # Create visualizations\n        plt.figure(figsize=(15, 10))\n        \n        # Correlation heatmap\n        plt.subplot(2, 2, 1)\n        sns.heatmap(self.df.corr(), annot=True, cmap='coolwarm')\n        plt.title('Correlation Matrix')\n        \n        # Distribution plot\n        plt.subplot(2, 2, 2)\n        self.df.hist(bins=20, figsize=(12, 8))\n        plt.tight_layout()\n        \n        plt.savefig('exploratory_analysis.png')\n        plt.show()\n    \n    def prepare_data(self, target_column, test_size=0.2):\n        \"\"\"Prepare data for machine learning\"\"\"\n        if self.df is None:\n            print(\"No data loaded.\")\n            return False\n        \n        # Separate features and target\n        X = self.df.drop(target_column, axis=1)\n        y = self.df[target_column]\n        \n        # Split data\n        self.X_train, self.X_test, self.y_train, self.y_test = train_test_split(\n            X, y, test_size=test_size, random_state=42\n        )\n        \n        print(f\"Data prepared. Training set: {self.X_train.shape}, Test set: {self.X_test.shape}\")\n        return True\n    \n    def train_model(self, model_type='linear'):\n        \"\"\"Train a machine learning model\"\"\"\n        if self.X_train is None:\n            print(\"Data not prepared. Run prepare_data first.\")\n            return False\n        \n        if model_type == 'linear':\n            self.model = LinearRegression()\n        else:\n            # Add more models as needed\n            self.model = LinearRegression()\n        \n        self.model.fit(self.X_train, self.y_train)\n        print(\"Model trained successfully.\")\n        return True\n    \n    def evaluate_model(self):\n        \"\"\"Evaluate the trained model\"\"\"\n        if self.model is None:\n            print(\"No model trained.\")\n            return\n        \n        # Make predictions\n        y_pred = self.model.predict(self.X_test)\n        \n        # Calculate metrics\n        mse = mean_squared_error(self.y_test, y_pred)\n        r2 = r2_score(self.y_test, y_pred)\n        \n        print(f\"Mean Squared Error: {mse:.2f}\")\n        print(f\"R-squared Score: {r2:.2f}\")\n        \n        # Plot predictions vs actual\n        plt.figure(figsize=(10, 6))\n        plt.scatter(self.y_test, y_pred, alpha=0.7)\n        plt.plot([self.y_test.min(), self.y_test.max()], [self.y_test.min(), self.y_test.max()], 'r--', lw=2)\n        plt.xlabel('Actual Values')\n        plt.ylabel('Predicted Values')\n        plt.title('Predictions vs Actual Values')\n        plt.savefig('model_evaluation.png')\n        plt.show()\n        \n        return {'mse': mse, 'r2': r2}\n\n# Usage example\nif __name__ == \"__main__\":\n    project = DataScienceProject()\n    \n    # Example usage (replace with your data file)\n    # project.load_data('your_data.csv')\n    # project.explore_data()\n    # project.prepare_data('target_column')\n    # project.train_model()\n    # results = project.evaluate_model()");
            
            files.put("notebooks/analysis.ipynb",
                "{\n \"cells\": [\n  {\n   \"cell_type\": \"markdown\",\n   \"metadata\": {},\n   \"source\": [\n    \"# \" + name + \" - Data Science Analysis\\n\",\n    \"\\n\",\n    \"This notebook contains the data analysis and machine learning workflow.\"\n   ]\n  },\n  {\n   \"cell_type\": \"code\",\n   \"execution_count\": null,\n   \"metadata\": {},\n   \"outputs\": [],\n   \"source\": [\n    \"import pandas as pd\\n\",\n    \"import numpy as np\\n\",\n    \"import matplotlib.pyplot as plt\\n\",\n    \"import seaborn as sns\\n\",\n    \"\\n\",\n    \"# Load your data\\n\",\n    \"# df = pd.read_csv('data.csv')\"\n   ]\n  }\n ],\n \"metadata\": {\n  \"kernelspec\": {\n   \"display_name\": \"Python 3\",\n   \"language\": \"python\",\n   \"name\": \"python3\"\n  },\n  \"language_info\": {\n   \"codemirror_mode\": {\n    \"name\": \"ipython\",\n    \"version\": 3\n   },\n   \"file_extension\": \".py\",\n   \"mimetype\": \"text/x-python\",\n   \"name\": \"python\",\n   \"nbconvert_exporter\": \"python\",\n   \"pygments_lexer\": \"ipython3\",\n   \"version\": \"3.8.0\"\n  }\n },\n \"nbformat\": 4,\n \"nbformat_minor\": 4\n}");
            
            files.put("requirements.txt", String.join("\n", dependencies));
        }
        
        private void initializeFastAPITemplate() {
            dependencies.add("fastapi>=0.68.0");
            dependencies.add("uvicorn[standard]>=0.15.0");
            dependencies.add("pydantic>=1.8.0");
            
            files.put("main.py",
                "from fastapi import FastAPI, HTTPException\nfrom fastapi.middleware.cors import CORSMiddleware\nfrom pydantic import BaseModel\nfrom typing import List, Optional\nimport uvicorn\n\napp = FastAPI(\n    title=\"" + name + " API\",\n    description=\"REST API built with FastAPI\",\n    version=\"1.0.0\"\n)\n\n# Enable CORS\napp.add_middleware(\n    CORSMiddleware,\n    allow_origins=[\"*\"],\n    allow_credentials=True,\n    allow_methods=[\"*\"],\n    allow_headers=[\"*\"],\n)\n\n# Pydantic models\nclass Item(BaseModel):\n    id: Optional[int] = None\n    name: str\n    description: Optional[str] = None\n    price: float\n    tax: Optional[float] = None\n\nclass ItemResponse(BaseModel):\n    id: int\n    name: str\n    description: Optional[str] = None\n    price: float\n    tax: Optional[float] = None\n    total_price: Optional[float] = None\n\n# In-memory database (replace with real database)\nitems_db = []\nnext_id = 1\n\n@app.get(\"/\")\nasync def root():\n    return {\"message\": \"مرحباً من " + name + " API\"}\n\n@app.get(\"/health\")\nasync def health_check():\n    return {\"status\": \"healthy\"}\n\n@app.post(\"/items/\", response_model=ItemResponse)\nasync def create_item(item: Item):\n    global next_id\n    \n    new_item = item.dict()\n    new_item['id'] = next_id\n    \n    if item.tax:\n        new_item['total_price'] = item.price + (item.price * item.tax)\n    else:\n        new_item['total_price'] = item.price\n    \n    items_db.append(new_item)\n    next_id += 1\n    \n    return new_item\n\n@app.get(\"/items/\", response_model=List[ItemResponse])\nasync def get_items():\n    return items_db\n\n@app.get(\"/items/{item_id}\", response_model=ItemResponse)\nasync def get_item(item_id: int):\n    for item in items_db:\n        if item['id'] == item_id:\n            return item\n    raise HTTPException(status_code=404, detail=\"Item not found\")\n\n@app.put(\"/items/{item_id}\", response_model=ItemResponse)\nasync def update_item(item_id: int, updated_item: Item):\n    for i, item in enumerate(items_db):\n        if item['id'] == item_id:\n            items_db[i] = updated_item.dict()\n            items_db[i]['id'] = item_id\n            return items_db[i]\n    raise HTTPException(status_code=404, detail=\"Item not found\")\n\n@app.delete(\"/items/{item_id}\")\nasync def delete_item(item_id: int):\n    for i, item in enumerate(items_db):\n        if item['id'] == item_id:\n            deleted_item = items_db.pop(i)\n            return {\"message\": f\"Item {item_id} deleted\", \"item\": deleted_item}\n    raise HTTPException(status_code=404, detail=\"Item not found\")\n\nif __name__ == \"__main__\":\n    uvicorn.run(app, host=\"0.0.0.0\", port=8000)");
            
            files.put("templates/swagger.html",
                "<!DOCTYPE html>\n<html>\n<head>\n    <title>" + name + " - API Documentation</title>\n    <link rel=\"stylesheet\" type=\"text/css\" href=\"https://unpkg.com/swagger-ui-dist@3.52.5/swagger-ui.css\" />\n    <style>html { direction: rtl; }</style>\n</head>\n<body>\n    <div id=\"swagger-ui\"></div>\n    <script src=\"https://unpkg.com/swagger-ui-dist@3.52.5/swagger-ui-bundle.js\"></script>\n    <script>\n        SwaggerUIBundle({\n            url: '/docs.json',\n            dom_id: '#swagger-ui',\n            presets: [\n                SwaggerUIBundle.presets.apis,\n                SwaggerUIBundle.presets.standalone\n            ],\n            layout: \"BaseLayout\",\n            deepLinking: true\n        });\n    </script>\n</body>\n</html>");
        }
        
        private void initializeConsoleTemplate() {
            dependencies.add("click>=8.0.0");
            
            files.put("main.py",
                "#!/usr/bin/env python3\n# -*- coding: utf-8 -*-\n\nimport click\nimport sys\nfrom datetime import datetime\n\n@click.group()\n@click.version_option(version='1.0.0')\ndef cli():\n    \"\"\"مرحباً بك في تطبيق " + name + "\"\"\"\n    click.echo(f\"تاريخ البدء: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\")\n\n@cli.command()\n@click.option('--name', '-n', default='عالم', help='الاسم المطلوب الترحيب به')\n@click.option('--times', '-t', default=1, help='عدد مرات التكرار')\ndef hello(name, times):\n    \"\"\"نطق رسالة ترحيب\"\"\"\n    for i in range(times):\n        click.echo(f\"مرحباً {name}! هذا هو التطبيق رقم {i+1}\")\n\n@cli.command()\n@click.argument('file_path')\ndef process_file(file_path):\n    \"\"\"معالجة ملف معين\"\"\"\n    try:\n        with open(file_path, 'r', encoding='utf-8') as file:\n            content = file.read()\n            click.echo(f\"تم قراءة الملف: {file_path}\")\n            click.echo(f\"عدد الأحرف: {len(content)}\")\n            click.echo(f\"عدد الأسطر: {len(content.splitlines())}\")\n    except FileNotFoundError:\n        click.echo(f\"خطأ: الملف {file_path} غير موجود\", err=True)\n    except Exception as e:\n        click.echo(f\"خطأ في قراءة الملف: {e}\", err=True)\n\n@cli.command()\n@click.option('--output', '-o', help='ملف الإخراج')\n@click.option('--format', type=click.Choice(['json', 'csv']), default='json', help='تنسيق الإخراج')\ndef export_data(output, format):\n    \"\"\"تصدير البيانات\"\"\"\n    sample_data = [\n        {'id': 1, 'name': 'العنصر الأول', 'value': 100},\n        {'id': 2, 'name': 'العنصر الثاني', 'value': 200}\n    ]\n    \n    if format == 'json':\n        import json\n        content = json.dumps(sample_data, ensure_ascii=False, indent=2)\n    else:\n        import csv\n        import io\n        output_buffer = io.StringIO()\n        writer = csv.DictWriter(output_buffer, fieldnames=['id', 'name', 'value'])\n        writer.writeheader()\n        writer.writerows(sample_data)\n        content = output_buffer.getvalue()\n    \n    if output:\n        with open(output, 'w', encoding='utf-8') as file:\n            file.write(content)\n        click.echo(f\"تم تصدير البيانات إلى: {output}\")\n    else:\n        click.echo(content)\n\n@cli.command()\ndef info():\n    \"\"\"عرض معلومات التطبيق\"\"\"\n    click.echo(\"=== معلومات " + name + " ===\")\n    click.echo(f\"الإصدار: 1.0.0\")\n    click.echo(f\"البيئة: {sys.platform}\")\n    click.echo(f\"الإصدار: {sys.version}\")\n\nif __name__ == '__main__':\n    cli()");
        }
        
        private void initializeGuitemplate() {
            dependencies.add("tkinter");
            
            files.put("main.py",
                "import tkinter as tk\nfrom tkinter import ttk, messagebox, filedialog\nimport os\nimport json\nfrom datetime import datetime\n\nclass " + name.replace(\" \", \"\") + "GUI:\n    def __init__(self, root):\n        self.root = root\n        self.root.title(\"" + name + " - GUI Application\")\n        self.root.geometry(\"800x600\")\n        self.root.configure(bg='#f0f0f0')\n        \n        self.setup_ui()\n        self.data = []\n    \n    def setup_ui(self):\n        # شريط القوائم\n        menubar = tk.Menu(self.root)\n        self.root.config(menu=menubar)\n        \n        # قائمة الملف\n        file_menu = tk.Menu(menubar, tearoff=0)\n        menubar.add_cascade(label=\"ملف\", menu=file_menu)\n        file_menu.add_command(label=\"جديد\", command=self.new_file)\n        file_menu.add_command(label=\"فتح\", command=self.open_file)\n        file_menu.add_command(label=\"حفظ\", command=self.save_file)\n        file_menu.add_separator()\n        file_menu.add_command(label=\"خروج\", command=self.root.quit)\n        \n        # قائمة التحرير\n        edit_menu = tk.Menu(menubar, tearoff=0)\n        menubar.add_cascade(label=\"تحرير\", menu=edit_menu)\n        edit_menu.add_command(label=\"نسخ\", command=self.copy_text)\n        edit_menu.add_command(label=\"لصق\", command=self.paste_text)\n        \n        # شريط الأدوات\n        toolbar = ttk.Frame(self.root)\n        toolbar.pack(side=tk.TOP, fill=tk.X)\n        \n        ttk.Button(toolbar, text=\"جديد\", command=self.new_record).pack(side=tk.LEFT, padx=2)\n        ttk.Button(toolbar, text=\"حفظ\", command=self.save_record).pack(side=tk.LEFT, padx=2)\n        ttk.Button(toolbar, text=\"حذف\", command=self.delete_record).pack(side=tk.LEFT, padx=2)\n        ttk.Button(toolbar, text=\"تحديث\", command=self.refresh_data).pack(side=tk.LEFT, padx=2)\n        \n        # إطار الإدخال\n        input_frame = ttk.LabelFrame(self.root, text=\"إدخال البيانات\", padding=10)\n        input_frame.pack(side=tk.TOP, fill=tk.X, padx=10, pady=5)\n        \n        ttk.Label(input_frame, text=\"الاسم:\").grid(row=0, column=0, sticky=tk.W, padx=5)\n        self.name_entry = ttk.Entry(input_frame, width=30)\n        self.name_entry.grid(row=0, column=1, padx=5, pady=2)\n        \n        ttk.Label(input_frame, text=\"القيمة:\").grid(row=1, column=0, sticky=tk.W, padx=5)\n        self.value_entry = ttk.Entry(input_frame, width=30)\n        self.value_entry.grid(row=1, column=1, padx=5, pady=2)\n        \n        ttk.Label(input_frame, text=\"الوصف:\").grid(row=2, column=0, sticky=tk.W, padx=5)\n        self.desc_entry = tk.Text(input_frame, width=30, height=3)\n        self.desc_entry.grid(row=2, column=1, padx=5, pady=2, sticky=tk.W)\n        \n        # زر الحفظ\n        ttk.Button(input_frame, text=\"حفظ السجل\", command=self.save_record).grid(row=3, column=1, pady=10)\n        \n        # جدول البيانات\n        table_frame = ttk.LabelFrame(self.root, text=\"السجلات\", padding=10)\n        table_frame.pack(side=tk.TOP, fill=tk.BOTH, expand=True, padx=10, pady=5)\n        \n        # Treeview مع شريط التمرير\n        tree_frame = ttk.Frame(table_frame)\n        tree_frame.pack(fill=tk.BOTH, expand=True)\n        \n        scrollbar = ttk.Scrollbar(tree_frame)\n        scrollbar.pack(side=tk.RIGHT, fill=tk.Y)\n        \n        self.tree = ttk.Treeview(tree_frame, yscrollcommand=scrollbar.set)\n        self.tree.pack(side=tk.LEFT, fill=tk.BOTH, expand=True)\n        scrollbar.config(command=self.tree.yview)\n        \n        # إعداد الأعمدة\n        self.tree['columns'] = ('id', 'name', 'value', 'description', 'date')\n        self.tree.heading('#0', text='التسلسل')\n        self.tree.heading('id', text='المعرف')\n        self.tree.heading('name', text='الاسم')\n        self.tree.heading('value', text='القيمة')\n        self.tree.heading('description', text='الوصف')\n        self.tree.heading('date', text='التاريخ')\n        \n        self.tree.column('#0', width=60)\n        self.tree.column('id', width=80)\n        self.tree.column('name', width=150)\n        self.tree.column('value', width=100)\n        self.tree.column('description', width=200)\n        self.tree.column('date', width=120)\n        \n        # ربط النقر المزدوج\n        self.tree.bind('<Double-1>', self.on_item_double_click)\n        \n        # شريط الحالة\n        self.status_var = tk.StringVar()\n        self.status_var.set(\"جاهز\")\n        status_bar = ttk.Label(self.root, textvariable=self.status_var, relief=tk.SUNKEN)\n        status_bar.pack(side=tk.BOTTOM, fill=tk.X)\n    \n    def new_file(self):\n        if messagebox.askokcancel(\"جديد\", \"هل تريد إنشاء ملف جديد؟\"):\n            self.clear_form()\n            self.data.clear()\n            self.refresh_tree()\n            self.status_var.set(\"تم إنشاء ملف جديد\")\n    \n    def open_file(self):\n        filename = filedialog.askopenfilename(\n            title=\"فتح ملف\",\n            filetypes=[(\"JSON files\", \"*.json\"), (\"All files\", \"*.*\")]\n        )\n        if filename:\n            try:\n                with open(filename, 'r', encoding='utf-8') as f:\n                    self.data = json.load(f)\n                self.refresh_tree()\n                self.status_var.set(f\"تم فتح: {os.path.basename(filename)}\")\n            except Exception as e:\n                messagebox.showerror(\"خطأ\", f\"فشل في فتح الملف: {e}\")\n    \n    def save_file(self):\n        filename = filedialog.asksaveasfilename(\n            title=\"حفظ ملف\",\n            defaultextension=\".json\",\n            filetypes=[(\"JSON files\", \"*.json\"), (\"All files\", \"*.*\")]\n        )\n        if filename:\n            try:\n                with open(filename, 'w', encoding='utf-8') as f:\n                    json.dump(self.data, f, ensure_ascii=False, indent=2)\n                self.status_var.set(f\"تم الحفظ: {os.path.basename(filename)}\")\n            except Exception as e:\n                messagebox.showerror(\"خطأ\", f\"فشل في حفظ الملف: {e}\")\n    \n    def new_record(self):\n        self.clear_form()\n        self.status_var.set(\"جديد سجل\")\n    \n    def save_record(self):\n        name = self.name_entry.get().strip()\n        value = self.value_entry.get().strip()\n        description = self.desc_entry.get('1.0', tk.END).strip()\n        \n        if not name:\n            messagebox.showwarning(\"تحذير\", \"يرجى إدخال الاسم\")\n            return\n        \n        try:\n            value = float(value) if value else 0.0\n        except ValueError:\n            messagebox.showerror(\"خطأ\", \"يرجى إدخال رقم صحيح للقيمة\")\n            return\n        \n        record = {\n            'id': len(self.data) + 1,\n            'name': name,\n            'value': value,\n            'description': description,\n            'date': datetime.now().strftime('%Y-%m-%d %H:%M:%S')\n        }\n        \n        self.data.append(record)\n        self.refresh_tree()\n        self.clear_form()\n        self.status_var.set(\"تم حفظ السجل\")\n    \n    def delete_record(self):\n        selected = self.tree.selection()[0] if self.tree.selection() else None\n        if not selected:\n            messagebox.showwarning(\"تحذير\", \"يرجى اختيار سجل للحذف\")\n            return\n        \n        if messagebox.askyesno(\"تأكيد الحذف\", \"هل تريد حذف هذا السجل؟\"):\n            index = int(self.tree.index(selected))\n            del self.data[index]\n            self.refresh_tree()\n            self.status_var.set(\"تم حذف السجل\")\n    \n    def refresh_data(self):\n        self.refresh_tree()\n        self.status_var.set(\"تم تحديث البيانات\")\n    \n    def refresh_tree(self):\n        # مسح جميع العناصر\n        for item in self.tree.get_children():\n            self.tree.delete(item)\n        \n        # إضافة البيانات\n        for i, record in enumerate(self.data):\n            self.tree.insert('', tk.END, text=str(i+1), values=(\n                record['id'],\n                record['name'],\n                record['value'],\n                record['description'][:50] + '...' if len(record['description']) > 50 else record['description'],\n                record['date']\n            ))\n    \n    def clear_form(self):\n        self.name_entry.delete(0, tk.END)\n        self.value_entry.delete(0, tk.END)\n        self.desc_entry.delete('1.0', tk.END)\n    \n    def on_item_double_click(self, event):\n        selected = self.tree.selection()[0] if self.tree.selection() else None\n        if not selected:\n            return\n        \n        index = int(self.tree.index(selected))\n        record = self.data[index]\n        \n        self.name_entry.delete(0, tk.END)\n        self.name_entry.insert(0, record['name'])\n        \n        self.value_entry.delete(0, tk.END)\n        self.value_entry.insert(0, str(record['value']))\n        \n        self.desc_entry.delete('1.0', tk.END)\n        self.desc_entry.insert('1.0', record['description'])\n        \n        self.status_var.set(f\"تم تحميل السجل: {record['name']}\")\n    \n    def copy_text(self):\n        self.root.clipboard_clear()\n        self.root.clipboard_append(self.name_entry.get())\n    \n    def paste_text(self):\n        try:\n            text = self.root.clipboard_get()\n            self.name_entry.insert(tk.END, text)\n        except tk.TclError:\n            pass\n\nif __name__ == '__main__':\n    root = tk.Tk()\n    app = " + name.replace(\" \", \"\") + "GUI(root)\n    root.mainloop()");
        }
        
        private String generateDescription(TemplateType type) {
            switch (type) {
                case DJANGO: return "تطبيق ويب متكامل مع Django - قاعدة بيانات، واجهة إدارية، وجاهز للإنتاج";
                case FLASK: return "تطبيق ويب بسيط مع Flask - مصمم للسرعة والتطوير السريع";
                case DATA_SCIENCE: return "مشروع علوم البيانات مع pandas, numpy, matplotlib - جاهز للتحليل";
                case FASTAPI: return "API REST سريع مع FastAPI - توثيق تلقائي وأداء عالي";
                case CONSOLE_APP: return "تطبيق وحدة التحكم مع Click - سطر أوامر تفاعلي";
                case GUI_APP: return "تطبيق واجهة رسومية مع Tkinter - تطبيق سطح مكتب كامل";
                default: return "قالب مشروع جاهز";
            }
        }
        
        private String generateInstructions(TemplateType type) {
            StringBuilder instructions = new StringBuilder();\n            instructions.append("# تعليمات إعداد ").append(name).append("\n\n");\n            \n            switch (type) {\n                case DJANGO:\n                    instructions.append("## خطوات الإعداد:\n");\n                    instructions.append("1. تثبيت المتطلبات: pip install -r requirements.txt\n");\n                    instructions.append("2. تطبيق الترحيلات: python manage.py makemigrations\n");\n                    instructions.append("3. تطبيق قاعدة البيانات: python manage.py migrate\n");\n                    instructions.append("4. إنشاء مستخدم إداري: python manage.py createsuperuser\n");\n                    instructions.append("5. تشغيل الخادم: python manage.py runserver\n");\n                    instructions.append("\\n# للوصول:\n");\n                    instructions.append("- الواجهة الرئيسية: http://localhost:8000\n");\n                    instructions.append("- واجهة الإدارة: http://localhost:8000/admin\n");\n                    break;\n                    \n                case FLASK:\n                    instructions.append("## خطوات الإعداد:\n");\n                    instructions.append("1. تثبيت المتطلبات: pip install -r requirements.txt\n");\n                    instructions.append("2. تشغيل التطبيق: python app.py\n");\n                    instructions.append("3. فتح المتصفح: http://localhost:5000\n");\n                    break;\n                    \n                case DATA_SCIENCE:\n                    instructions.append("## خطوات الاستخدام:\n");\n                    instructions.append("1. تثبيت المتطلبات: pip install -r requirements.txt\n");\n                    instructions.append("2. تشغيل Jupyter: jupyter notebook\n");\n                    instructions.append("3. فتح الملف: notebooks/analysis.ipynb\n");\n                    instructions.append("4. تشغيل التطبيق: python main.py\n");\n                    break;\n                    \n                case FASTAPI:\n                    instructions.append("## خطوات التشغيل:\n");\n                    instructions.append("1. تثبيت المتطلبات: pip install -r requirements.txt\n");\n                    instructions.append("2. تشغيل الخادم: uvicorn main:app --reload\n");\n                    instructions.append("3. الوصول للتوثيق: http://localhost:8000/docs\n");\n                    instructions.append("4. الواجهة التفاعلية: http://localhost:8000/redoc\n");\n                    break;\n                    \n                case CONSOLE_APP:\n                    instructions.append("## طريقة الاستخدام:\n");\n                    instructions.append("1. تثبيت المتطلبات: pip install -r requirements.txt\n");\n                    instructions.append("2. تشغيل المساعدة: python main.py --help\n");\n                    instructions.append("3. تشغيل مثال: python main.py hello --name أحمد --times 3\n");\n                    break;\n                    \n                case GUI_APP:\n                    instructions.append("## تشغيل التطبيق:\n");\n                    instructions.append("1. التأكد من تثبيت tkinter\n");\n                    instructions.append("2. تشغيل التطبيق: python main.py\n");\n                    instructions.append("3. استخدام واجهة الرسوم التفاعلية\n");\n                    break;\n            }\n            \n            instructions.append("\n## ملاحظات:\n");\n            instructions.append("- تأكد من تحديث ملف requirements.txt حسب احتياجاتك\n");\n            instructions.append("- يمكن تخصيص القوالب حسب متطلبات مشروعك\n");\n            instructions.append("- للاستخدام في الإنتاج، قم بتحديث إعدادات الأمان\n");\n            \n            return instructions.toString();\n        }\n        \n        // Getters\n        public String getName() { return name; }\n        public TemplateType getType() { return type; }\n        public String getDescription() { return description; }\n        public Map<String, String> getFiles() { return files; }\n        public List<String> getDependencies() { return dependencies; }\n        public String getSetupInstructions() { return setupInstructions; }\n    }\n    \n    private Map<TemplateType, ProjectTemplate> templates;\n    \n    public ProjectTemplates() {\n        this.templates = new HashMap<>();\n        initializeTemplates();\n    }\n    \n    private void initializeTemplates() {\n        templates.put(TemplateType.DJANGO, new ProjectTemplate("MyDjangoApp", TemplateType.DJANGO));\n        templates.put(TemplateType.FLASK, new ProjectTemplate("MyFlaskApp", TemplateType.FLASK));\n        templates.put(TemplateType.DATA_SCIENCE, new ProjectTemplate("DataScienceProject", TemplateType.DATA_SCIENCE));\n        templates.put(TemplateType.FASTAPI, new ProjectTemplate("FastAPIApp", TemplateType.FASTAPI));\n        templates.put(TemplateType.CONSOLE_APP, new ProjectTemplate("ConsoleApp", TemplateType.CONSOLE_APP));\n        templates.put(TemplateType.GUI_APP, new ProjectTemplate("GUI Application", TemplateType.GUI_APP));\n    }\n    \n    /**\n     * Get all available templates\n     */\n    public Map<TemplateType, ProjectTemplate> getAllTemplates() {\n        return new HashMap<>(templates);\n    }\n    \n    /**\n     * Create a new project from template\n     */\n    public CompletableFuture<Boolean> createProjectFromTemplate(String projectName, TemplateType type) {\n        return CompletableFuture.supplyAsync(() -> {\n            ProjectTemplate template = templates.get(type);\n            if (template == null) {\n                return false;\n            }\n            \n            try {\n                File projectDir = new File(projectName);\n                if (!projectDir.exists()) {\n                    projectDir.mkdirs();\n                }\n                \n                // Create all files from template\n                for (Map.Entry<String, String> fileEntry : template.getFiles().entrySet()) {\n                    File file = new File(projectDir, fileEntry.getKey());\n                    File parentDir = file.getParentFile();\n                    if (parentDir != null && !parentDir.exists()) {\n                        parentDir.mkdirs();\n                    }\n                    \n                    try (FileWriter writer = new FileWriter(file)) {\n                        writer.write(fileEntry.getValue());\n                    }\n                }\n                \n                // Create requirements.txt\n                File requirementsFile = new File(projectDir, \"requirements.txt\")\n                try (FileWriter writer = new FileWriter(requirementsFile)) {\n                    for (String dependency : template.getDependencies()) {\n                        writer.write(dependency + \"\\n\");\n                    }\n                }\n                \n                // Create README.md\n                File readmeFile = new File(projectDir, \"README.md\");\n                try (FileWriter writer = new FileWriter(readmeFile)) {\n                    writer.write(\"# \" + projectName + \"\\n\\n\");\n                    writer.write(template.getDescription() + \"\\n\\n\");\n                    writer.write(\"## التثبيت\\n\\n\");\n                    writer.write(\"```bash\\n\");\n                    writer.write(\"pip install -r requirements.txt\\n\");\n                    writer.write(\"```\\n\\n\");\n                    writer.write(\"## الاستخدام\\n\\n\");\n                    writer.write(template.getSetupInstructions());\n                }\n                \n                return true;\n                \n            } catch (Exception e) {\n                return false;\n            }\n        });\n    }\n    \n    /**\n     * Export template as ZIP file\n     */\n    public CompletableFuture<String> exportTemplateAsZip(String projectName, TemplateType type) {\n        return CompletableFuture.supplyAsync(() -> {\n            ProjectTemplate template = templates.get(type);\n            if (template == null) {\n                return null;\n            }\n            \n            try {\n                String zipFileName = projectName + \".zip\";\n                try (FileOutputStream fos = new FileOutputStream(zipFileName);\n                     ZipOutputStream zos = new ZipOutputStream(fos)) {\n                    \n                    for (Map.Entry<String, String> fileEntry : template.getFiles().entrySet()) {\n                        ZipEntry zipEntry = new ZipEntry(fileEntry.getKey());\n                        zos.putNextEntry(zipEntry);\n                        \n                        byte[] bytes = fileEntry.getValue().getBytes();\n                        zos.write(bytes, 0, bytes.length);\n                        zos.closeEntry();\n                    }\n                    \n                    // Add requirements.txt\n                    ZipEntry requirementsEntry = new ZipEntry(\"requirements.txt\");\n                    zos.putNextEntry(requirementsEntry);\n                    StringBuilder requirements = new StringBuilder();\n                    for (String dependency : template.getDependencies()) {\n                        requirements.append(dependency).append(\"\\n\");\n                    }\n                    byte[] reqBytes = requirements.toString().getBytes();\n                    zos.write(reqBytes, 0, reqBytes.length);\n                    zos.closeEntry();\n                    \n                    // Add README.md\n                    ZipEntry readmeEntry = new ZipEntry(\"README.md\");\n                    zos.putNextEntry(readmeEntry);\n                    StringBuilder readme = new StringBuilder();\n                    readme.append(\"# \").append(projectName).append(\"\\n\\n\");\n                    readme.append(template.getDescription()).append(\"\\n\\n\");\n                    readme.append(\"## التثبيت\\n\\n```bash\\n\");\n                    readme.append(\"pip install -r requirements.txt\\n```\\n\\n\");\n                    readme.append(\"## الاستخدام\\n\\n\");\n                    readme.append(template.getSetupInstructions());\n                    byte[] readmeBytes = readme.toString().getBytes();\n                    zos.write(readmeBytes, 0, readmeBytes.length);\n                    zos.closeEntry();\n                }\n                \n                return zipFileName;\n                \n            } catch (Exception e) {\n                return null;\n            }\n        });\n    }\n    \n    /**\n     * Get template details for preview\n     */\n    public String getTemplatePreview(TemplateType type) {\n        ProjectTemplate template = templates.get(type);\n        if (template == null) {\n            return \"Template not found\";\n        }\n        \n        StringBuilder preview = new StringBuilder();\n        preview.append(\"# \").append(template.getName()).append(\"\\n\\n\");\n        preview.append(\"**النوع:** \").append(template.getType().name()).append(\"\\n\\n\");\n        preview.append(\"**الوصف:** \").append(template.getDescription()).append(\"\\n\\n\");\n        preview.append(\"**المتطلبات:**\\n\");\n        for (String dep : template.getDependencies()) {\n            preview.append(\"- \").append(dep).append(\"\\n\");\n        }\n        preview.append(\"\\n**الملفات الرئيسية:**\\n\");\n        for (String fileName : template.getFiles().keySet()) {\n            preview.append(\"- \").append(fileName).append(\"\\n\");\n        }\n        preview.append(\"\\n**تعليمات الإعداد:**\\n\");\n        preview.append(template.getSetupInstructions());\n        \n        return preview.toString();\n    }\n    \n    /**\n     * Search templates by keyword\n     */\n    public List<TemplateType> searchTemplates(String keyword) {\n        List<TemplateType> results = new ArrayList<>();\n        String searchTerm = keyword.toLowerCase();\n        \n        for (Map.Entry<TemplateType, ProjectTemplate> entry : templates.entrySet()) {\n            TemplateType type = entry.getKey();\n            ProjectTemplate template = entry.getValue();\n            \n            if (type.name().toLowerCase().contains(searchTerm) ||\n                template.getDescription().toLowerCase().contains(searchTerm) ||\n                template.getName().toLowerCase().contains(searchTerm)) {\n                results.add(type);\n            }\n        }\n        \n        return results;\n    }\n    \n    /**\n     * Create custom template\n     */\n    public ProjectTemplate createCustomTemplate(String name, TemplateType type, \n                                               Map<String, String> files, \n                                               List<String> dependencies) {\n        ProjectTemplate customTemplate = new ProjectTemplate(name, type);\n        customTemplate.files.putAll(files);\n        customTemplate.dependencies.addAll(dependencies);\n        \n        templates.put(type, customTemplate);\n        return customTemplate;\n    }\n}